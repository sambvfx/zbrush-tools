// Copyright (c) 2015 Sam Bourne
// All rights reserved.

// Quick and inefficient script for selecting a SubTool specified by the user.

[ISubPalette, "Zplugin:Misc Tools"]

[IButton
    ,"Zplugin:Misc Tools:Select Mesh"
    ,"Select specified mesh by typing the name"
    , // CODE TO EXECUTE
        [VarSet, fsubtool, [StrAsk, "SubToolName", "Enter a SubTool name."]]
        [VarSet, index, 0]
        [VarSet, found, 0]
        [IFreeze,
            [VarSet, osubtool, [SubToolGetActiveIndex]]
            [Loop, [SubToolGetCount],

                // select the subtol
                [SubToolSelect, [Val, index]]

                // get subtool name
                [VarSet, subToolName, [IGetTitle, Tool:Item Info]]
                // trim off end period
                [VarSet, subToolName, [StrExtract, subToolName, 0, [StrLength, subToolName]-2]]

                // if the subtool name is the same as the input name, break the loop
                [If, ([StrLength, subToolName] == [StrLength, fsubtool])&&([StrFind, fsubtool, subToolName]>-1),
                    // True
                    [VarSet, found, 1][LoopExit],
                    // False
                    [VarInc, index]
                ]
            ]
        ]

        // if something was not found select original selection and message the user
        [If, ([Val, found] == 1),
            // True, do nothing
            ,
            // False
            [Note, [StrMerge, "Subtool not found: ", [Var, fsubtool]]][SubtoolSelect, [Val, osubtool]]
        ]
]
